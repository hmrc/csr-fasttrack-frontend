@import viewmodels.application.scheme.SchemePreferenceViewModel
@import views.html.widgets.yesNoQuestion
@import _root_.forms.SchemePreferenceForm

@import connectors.exchange.SchemeInfo
@(
        schemesForm: Form[_root_.forms.SchemePreferenceForm.Data],
        viewModel: SchemePreferenceViewModel
)(implicit request: Request[_], flash: Flash, user: Option[CachedData], feedbackUrl: String)

@import helpers.CSRFieldConstructor._
@import views.html.widgets.{guard, guardWithLabel, inputCheckboxGroup, radioBox, select_guard}

@selectedSchemes = @{
    schemesForm.value match {
        case Some(schForm) => schForm.schemes.lift(_)
        case _ => SchemePreferenceForm.getSchemesByPriority("schemes", schemesForm.data).lift(_)
    }
}

@schemeRequirements(scheme: SchemeInfo) = {
    @if(scheme.requiresALevelInStem) {
        2 A levels A* to C in STEM subjects and 5 GCSEs A* to C including English language and maths
    } else {
        @if(scheme.requiresALevel) {
            5 GCSEs A* to C including English language and maths
        } else {
            2 A levels A* to D in any subject and 5 GCSEs A* to C including English language and maths
        }
    }
}

@main_template(title = "Choose your preferred schemes", pageForms = Seq(schemesForm), None, List("scheme-preference-selector.js")) {

    @helper.form(action = routes.SchemeController.submitSchemes(), 'novalidate -> "novalidate") {
        @helper.CSRF.formField
<h1 class="heading-xlarge" xmlns="http://www.w3.org/1999/html">Choose your preferred schemes</h1>

        <div class="panel-indent">
            <p>In preference order, select only the schemes you'd like to work in.</p>
        </div>
        <section class="grid-wrapper scheme-wrapper">
            <div class="scheme-input-container">
                <div class="inner-block-padr">
                    <ul class="schemes-list">
                        @for(scheme <- viewModel.schemeOptions) {
                            <li class="scheme-container">
                                <span class="selected-preference invisible">N/A</span>
                                <label for="scheme-@scheme.id" class="block-label block-label-slim">
                                    <input type="checkbox" id="scheme-@scheme.id" data-schemename value="@scheme.id">@scheme.name</input>
                                </label>
                                <span class="alwayshidden" data-scheme-req>@schemeRequirements(scheme)</span>
                            </li>
                        }
                        @for(i <- 0 until viewModel.schemeOptions.size) {
                            <input type="hidden" id="schemes_@i" name="schemes_@i" value='@selectedSchemes(i).getOrElse("")' />
                        }
                    </ul>
                </div>
            </div>
        </section>
        <section id="selectedPreferences" class="hide-nojs">
            <h2 class="heading-large">Your chosen schemes</h2>
            <div data-scheme-placeholder>
                <div class="scheme-warning text">
                    <p>Your schemes will appear here as you select them from the list</p>
                </div>
            </div>
            <ol id="selectedPrefList" class="list-text">
                <li></li>
            </ol>
                &nbsp;
        </section>
        <section class="text panel-indent">
            <p>Your schemes will be offered to you in order of preference.</p>
            <p>You will not be able to reorder them after submitting your application.</p>
        </section>
        <section class="text clearfix">
            @yesNoQuestion(schemesForm("orderAgreed"), question = "Are you happy with the order of your schemes?",
            noMessage = Some("Review your preferences and confirm you're happy with the order to continue"))
        </section>
        <button type="submit" id="schemeSaveBtn" class="button">Save and continue</button>
    }
}
