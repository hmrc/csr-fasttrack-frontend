@(title: String, preferenceForm: Form[_root_.forms.SchemeLocationPreferenceForm.Data], action:Call, selection: models.frameworks.LocationAndSchemeSelection, disabledLocation: Option[String] = None, showNoSecondPreference: Boolean = false)(regions: List[models.frameworks.Region])(buttons: Html)(implicit request: Request[_], flash: Flash, user: Option[CachedData])

<div id="chooseLocationAndScheme">

<section>
    <h2 class="heading-medium" id="chooseHeading">
        @title
    </h2>
    <div id="selectLocationBlurb" class="hide-nojs">
        <p class="visuallyhidden"><a href="" id="viewListOfLocations-hidden">Open list of all locations</a>.</p>
        <p>Select a region on the map to list the available locations.
            Different locations will have different schemes available to apply for.</p>
            <p>Once you've selected at least one location, you'll then be able to tell us if you'd consider alternative locations.</p>
        <p>You can see a <a href="" id="viewListOfLocations">list of the locations</a>.</p>
    </div>
    @if(showNoSecondPreference) {
        @helper.form(action = routes.SchemeController.considerSecondPreference(false), 'novalidate -> "novalidate") {
            @helper.CSRF.formField
            <button type="submit" value="submit" class="button-link" id="noSecondPreference">
                Continue without a second preference
            </button>
        }
    }

    <p class="hide-js">Choose a location from the list</p>
    <p id="chosenRegionBlurb" class="toggle-content hide-nojs">Choose a location in the region: <b></b>
    </p>
    <p class="toggle-content hide-nojs" id="locationSelectedText" aria-live="polite">
        Location selected
    </p>
    @helper.form(action = action, 'novalidate -> "novalidate", 'id -> "preferenceForm") {
        @helper.CSRF.formField

        <div class="grid-2-3 toggle-content" id="listOfLocationsContainer">
            <a id="location.unavailable_field" name="location.unavailable_field"></a>
        @helper.input(preferenceForm("regionAndlocation")) { (id, name, value, args) =>
            <select name="regionAndlocation" id="regionSelect">
                <option value="null">Choose from list of locations</option>
                @for(region <- regions) {
                    <optgroup class="@region.name" data-optregion="@region.name" label="@region.name">
                    @for(location <- region.locations) {
                        <option value="@region.name;@location.name" @if(value.getOrElse("") == s"${region.name};${location.name}") {
                            selected="selected"
                        } @if(s"${region.name};${location.name}" == disabledLocation.getOrElse("")) {
                            disabled="disabled"}>@location.name</option>
                    }
                    </optgroup>
                }
            </select>
        }
        </div>
</section>
<section class="toggle-content" id="locationSelectedContainer" aria-hidden="true" aria-live="polite">
    <div class="hgroup-medium">
        <h2 class="heading-medium" aria-live="polite">Choose a scheme</h2>
        <p class="subtitle">
            <a href="https://www.gov.uk/guidance/civil-service-fast-track-apprenticeship-fast-track-schemes" rel="external" target="_blank">Find out more about the schemes we offer</a>
        </p>
    </div>
    <div class="panel-indent">
        <p>Scheme availability varies depending on your selected location and your education details</p>
    </div>

    <div class="grid-3-4">
        <div class="form-group">
            <a id="firstScheme.unavailable_field" name="firstScheme.unavailable_field"></a>
            <label for="schemePref1" class="form-label">First preference of scheme</label>
            @helper.input(preferenceForm("firstScheme")) { (id, name, value, args) =>
                <select name="firstScheme" data-scheme="@value" id="schemePref1">
                    <option value="" class="placeholder-option">Choose a scheme</option>
                    <noscript>
                    @for(framework <- regions.flatMap(_.locations).flatMap(_.frameworks).distinct) {
                        <option value="@framework" @if(value.contains(framework)) {
                            selected="selected"}>@framework</option>
                    }
                    </noscript>
                </select>
            }
            </div>
        <div class="form-group" id="secondPreferenceContainer">
            <a id="secondScheme.duplicate_field" name="secondScheme.duplicate_field"></a>
            <a id="secondScheme.unavailable_field" name="secondScheme.unavailable_field"></a>
            <label for="schemePref2" class="form-label">Second preference of scheme</label>
            @helper.input(preferenceForm("secondScheme")) { (id, name, value, args) =>
                <select name="secondScheme" data-scheme="@value" id="schemePref2" optional>
                    <option value="" class="placeholder-option">Choose a scheme</option>
                    <noscript>
                    @for(framework <- regions.flatMap(_.locations).flatMap(_.frameworks).distinct) {
                        <option value="@framework" @if(value.contains(framework)) {
                            selected="selected"}>@framework</option>
                    }
                    </noscript>
                    <option value="">No second preference</option>
                </select>
            }
        </div>
    </div>
</section>
</div>
<div>
@buttons
</div>
}
<script>
     var availableLocationsAndSchemes = @Html(models.frameworks.Region.toJson(regions));
     var disabledLocation = '@disabledLocation.getOrElse("")';
</script>
